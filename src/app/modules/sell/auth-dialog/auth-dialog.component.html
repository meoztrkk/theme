<!-- GÄ°RÄ°Å -->
<div *ngIf="view === 'login'" class="auth-shell">
  <div class="auth-header">
    <span class="auth-title">GiriÅŸ Yap</span>
    <button class="auth-close" (click)="close()">Ã—</button>
  </div>
  <div class="auth-divider"></div>

  <form class="auth-content" [formGroup]="loginForm">
    <div *ngIf="errorMessage" class="auth-error">
      {{ errorMessage }}
    </div>

    <label class="auth-label">Telefon numarasÄ±</label>
    <div class="auth-phone">
      <div class="auth-flag">ğŸ‡¹ğŸ‡·</div>
      <input
        class="auth-input phone"
        [class.auth-input-error]="loginForm.get('phone')?.invalid && loginForm.get('phone')?.touched"
        placeholder="0 (___) ___ ____"
        formControlName="phone"
        type="tel"
      />
    </div>
    @if (loginForm.get('phone')?.hasError('required') && loginForm.get('phone')?.touched) {
      <div class="auth-field-error">Telefon numarasÄ± zorunludur</div>
    }

    <label class="auth-label">Åifre</label>
    <input
      class="auth-input"
      [class.auth-input-error]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched"
      type="password"
      formControlName="password"
      placeholder="Åifre"
    />
    @if (loginForm.get('password')?.hasError('required') && loginForm.get('password')?.touched) {
      <div class="auth-field-error">Åifre zorunludur</div>
    }

    <button type="button" class="auth-forgot-password" (click)="switchTo('forgot-password')">
      Åifrenizi mi unuttunuz?
    </button>

    <button type="button" class="auth-btn primary" (click)="submitLogin()" [disabled]="isSending">
      <span *ngIf="!isSending">GiriÅŸ Yap</span>
      <span *ngIf="isSending">GiriÅŸ yapÄ±lÄ±yor...</span>
    </button>

    <div class="auth-footer">
      Ãœye deÄŸil misiniz?
      <button type="button" class="auth-link" (click)="switchTo('register')">
        KayÄ±t ol
      </button>
    </div>
  </form>
</div>

<!-- KAYIT -->
<div *ngIf="view === 'register'" class="auth-shell">
  <div class="auth-header">
    <span class="auth-title">KayÄ±t</span>
    <button class="auth-close" (click)="close()">Ã—</button>
  </div>
  <div class="auth-divider"></div>

  <form class="auth-content" [formGroup]="registerForm">
    <div *ngIf="errorMessage" class="auth-error">
      {{ errorMessage }}
    </div>

    <label class="auth-label">Telefon numarasÄ±</label>
    <div class="auth-phone">
      <div class="auth-flag">ğŸ‡¹ğŸ‡·</div>
      <input
        class="auth-input phone"
        [class.auth-input-error]="registerForm.get('phone')?.invalid && registerForm.get('phone')?.touched"
        placeholder="0 (___) ___ ____"
        formControlName="phone"
        type="tel"
      />
    </div>
    @if (registerForm.get('phone')?.hasError('required') && registerForm.get('phone')?.touched) {
      <div class="auth-field-error">Telefon numarasÄ± zorunludur</div>
    }

    <label class="auth-label">Ad</label>
    <input
      class="auth-input"
      [class.auth-input-error]="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched"
      formControlName="firstName"
      placeholder="AdÄ±nÄ±z"
      type="text"
    />
    @if (registerForm.get('firstName')?.hasError('required') && registerForm.get('firstName')?.touched) {
      <div class="auth-field-error">Ad zorunludur</div>
    }

    <label class="auth-label">Soyad</label>
    <input
      class="auth-input"
      [class.auth-input-error]="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched"
      formControlName="lastName"
      placeholder="SoyadÄ±nÄ±z"
      type="text"
    />
    @if (registerForm.get('lastName')?.hasError('required') && registerForm.get('lastName')?.touched) {
      <div class="auth-field-error">Soyad zorunludur</div>
    }

    <label class="auth-label">Email</label>
    <input
      class="auth-input"
      [class.auth-input-error]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
      formControlName="email"
      placeholder="email@example.com"
      type="email"
    />
    @if (registerForm.get('email')?.hasError('required') && registerForm.get('email')?.touched) {
      <div class="auth-field-error">Email zorunludur</div>
    }
    @if (registerForm.get('email')?.hasError('email') && registerForm.get('email')?.touched && !registerForm.get('email')?.hasError('required')) {
      <div class="auth-field-error">GeÃ§erli bir email adresi giriniz</div>
    }

    <label class="auth-label">Åifre</label>
    <input
      class="auth-input"
      [class.auth-input-error]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
      formControlName="password"
      type="password"
      placeholder="En az 6 karakter"
    />
    @if (registerForm.get('password')?.hasError('required') && registerForm.get('password')?.touched) {
      <div class="auth-field-error">Åifre zorunludur</div>
    }
    @if (registerForm.get('password')?.hasError('minlength') && registerForm.get('password')?.touched && !registerForm.get('password')?.hasError('required')) {
      <div class="auth-field-error">Åifre en az 6 karakter olmalÄ±dÄ±r</div>
    }

    <div class="auth-checkboxes">
      <mat-checkbox formControlName="consentCommercial" class="auth-checkbox">
        <span class="auth-checkbox-text">
          <a
            routerLink="/clarification-text-pdp"
            target="_blank"
            class="auth-checkbox-link"
            (click)="$event.stopPropagation()"
          >
            MÃ¼ÅŸteri AydÄ±nlatma Metni
          </a>
          kapsamÄ±nda Direkt SatÄ±ÅŸ'Ä±n ticari e-ileti gÃ¶ndermesine veya aramasÄ±na ve kiÅŸisel verilerimin yurtdÄ±ÅŸÄ±na aktarÄ±lmasÄ±na aÃ§Ä±k rÄ±za veriyorum.
        </span>
      </mat-checkbox>
      @if (registerForm.get('consentCommercial')?.hasError('requiredTrue') && registerForm.get('consentCommercial')?.touched) {
        <div class="auth-checkbox-error">Bu alan zorunludur</div>
      }

      <mat-checkbox formControlName="consentTerms" class="auth-checkbox">
        <span class="auth-checkbox-text">
          <a
            routerLink="/kvkk-clarification-text"
            target="_blank"
            class="auth-checkbox-link"
            (click)="$event.stopPropagation()"
          >
            HÃ¼kÃ¼m ve KoÅŸullarÄ±
          </a>
          kabul ediyorum.
        </span>
      </mat-checkbox>
      @if (registerForm.get('consentTerms')?.hasError('requiredTrue') && registerForm.get('consentTerms')?.touched) {
        <div class="auth-checkbox-error">Bu alan zorunludur</div>
      }
    </div>

    <p class="auth-info-text">
      Kaydolarak
      <a
        routerLink="/clarification-text-pdp"
        target="_blank"
        class="auth-info-link"
      >
        AydÄ±nlatma Metni
      </a>
      'ni okuduÄŸunuzu kabul etmektesiniz.
    </p>

    <button
      type="button"
      class="auth-btn primary"
      (click)="submitRegister()"
      [disabled]="isSending"
    >
      <span *ngIf="!isSending">KayÄ±t ol</span>
      <span *ngIf="isSending">KayÄ±t yapÄ±lÄ±yor...</span>
    </button>

    <div class="auth-footer">
      Zaten Ã¼ye misiniz?
      <button type="button" class="auth-link" (click)="switchTo('login')">
        GiriÅŸ Yap
      </button>
    </div>
  </form>
</div>

<!-- SMS DOÄRULAMA -->
<div *ngIf="view === 'verify'" class="auth-shell">
  <div class="auth-header">
    <button class="auth-back" (click)="switchTo('register')">â†</button>
    <span class="auth-title">Telefon doÄŸrulama</span>
    <button class="auth-close" (click)="close()">Ã—</button>
  </div>
  <div class="auth-divider"></div>

  <div class="auth-content verify" [formGroup]="verifyForm">
    <div *ngIf="errorMessage" class="auth-error">
      {{ errorMessage }}
    </div>

    <p class="verify-text">Telefonunuza bir doÄŸrulama kodu gÃ¶nderdik:</p>
    <p class="verify-phone">{{ phoneForVerify }}</p>

    <div class="verify-codes">
      <input
        #codeInput
        maxlength="1"
        formControlName="code1"
        (input)="onCodeInput(0, $event)"
        [disabled]="isSending"
      />
      <input
        #codeInput
        maxlength="1"
        formControlName="code2"
        (input)="onCodeInput(1, $event)"
        [disabled]="isSending"
      />
      <input
        #codeInput
        maxlength="1"
        formControlName="code3"
        (input)="onCodeInput(2, $event)"
        [disabled]="isSending"
      />
      <input
        #codeInput
        maxlength="1"
        formControlName="code4"
        (input)="onCodeInput(3, $event)"
        [disabled]="isSending"
      />
    </div>

    <button type="button" class="auth-btn primary" (click)="submitVerify()" [disabled]="isSending">
      <span *ngIf="!isSending">DoÄŸrula</span>
      <span *ngIf="isSending">DoÄŸrulanÄ±yor...</span>
    </button>

    <p class="verify-resend">
      Mesaj gelmedi mi?
      <ng-container *ngIf="countdown > 0">
        {{ countdown }} saniye sonra tekrar gÃ¶nder
      </ng-container>
      <button *ngIf="countdown <= 0" class="auth-link" (click)="resendCode()">
        Tekrar gÃ¶nder
      </button>
    </p>
  </div>
</div>

<!-- ÅÄ°FREMÄ° UNUTTUM -->
<div *ngIf="view === 'forgot-password'" class="auth-shell">
  <div class="auth-header">
    <button class="auth-back" (click)="switchTo('login')">â†</button>
    <span class="auth-title">Åifrenizi mi unuttunuz?</span>
    <button class="auth-close" (click)="close()">Ã—</button>
  </div>
  <div class="auth-divider"></div>

  <form class="auth-content" [formGroup]="forgotPasswordForm">
    <div *ngIf="errorMessage" class="auth-error">
      {{ errorMessage }}
    </div>

    <p class="forgot-password-text">
      Åifrenizi yenilemek iÃ§in lÃ¼tfen aÅŸaÄŸÄ±ya telefon numaranÄ±zÄ± girin
    </p>

    <label class="auth-label">Telefon numarasÄ±</label>
    <div class="auth-phone">
      <div class="auth-flag">ğŸ‡¹ğŸ‡·</div>
      <input
        class="auth-input phone"
        [class.auth-input-error]="forgotPasswordForm.get('phone')?.invalid && forgotPasswordForm.get('phone')?.touched"
        placeholder="0 (___) ___ ____"
        formControlName="phone"
        type="tel"
      />
    </div>
    @if (forgotPasswordForm.get('phone')?.hasError('required') && forgotPasswordForm.get('phone')?.touched) {
      <div class="auth-field-error">Telefon numarasÄ± zorunludur</div>
    }

    <button
      type="button"
      class="auth-btn primary"
      (click)="submitForgotPassword()"
      [disabled]="isSending"
    >
      <span *ngIf="!isSending">Devam</span>
      <span *ngIf="isSending">GÃ¶nderiliyor...</span>
    </button>
  </form>
</div>
